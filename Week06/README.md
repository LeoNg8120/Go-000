#### hystrix学习笔记
#### 一、简介
  1. circuit-breaker： circuit表示电路，大家译为熔断器非常精准。  
  2. 回想起小时候，家里保险丝突然被烧断，需 手工更换一根新的保险丝；后来，保险丝被取代，电流过大时会跳闸，闸拉上去后立马恢复供电；等到上大学时，只要打开功率高一点的电吹风，砰的一声就断电，但过10分钟就自动来电。在电流过大时，通过熔断机制以保护电路和家电。  
  3. Hystrix 属于上面的第三种，一种自动恢复的智能熔断器，区别在于它保护的是系统，且判断 “电流过大” 的方式是：不断收集请求指标信息(sucess、failure、timeout、rejection)，当达到设定熔断条件时(默认是请求失败率达到50%)进行熔断。  
  4. Hystrix Command 执行过程中，各种情况都以事件形式发出，再封装成特定的数据结构，最后汇入到事件流中(HystrixEventStream)。事件流提供了 observe() 方法，摇身一变，事件流把自己变成了一个数据源(各小溪汇入成河，消费者从河里取水)，其他消费者可以从这里获取数据，而 circuit-breaker 就是消费者之一。
  
#### 二、原理
  1. 在统计中，会使用一定数量的样本，并将样本进行分组，最后进行统计分析。Hystrix 有点类似，例如：以秒为单位来统计请求的处理情况(成功请求数量、失败请求数、超时请求数、被拒绝的请求数)，然后每次取最近10秒的数据来进行计算，如果失败率超过50%，就进行熔断，不再处理任何请求。  
  2. 它演示了 Hystrix 滑动窗口 策略，假定以秒为单位来统计请求处理情况，上面每个格子代表1秒，格子中的数据就是1秒内各处理结果的请求数量，格子称为 Bucket(译为桶)。  
     若每次的决策都以10个Bucket的数据为依据，计算10个Bucket的请求处理情况，当失败率超过50%时就熔断。10个Bucket就是10秒，这个10秒就是一个 滑动窗口(Rolling window)。  
     为什么叫滑动窗口？因为在没有熔断时，每当收集好一个新的Bucket后，就会丢弃掉最旧的一个Bucket。上图中的深色的(23 5 2 0)就是被丢弃的桶，这和拿着放大镜从左到右看书有点类似，视野永远是放大镜那一部分。  
     下面是官方完整的流程图，策略是：不断收集数据，达到条件就熔断；熔断后拒绝所有请求一段时间(sleepWindow)；然后放一个请求过去，如果请求成功，则关闭熔断器，否则继续打开熔断器。  
     
  